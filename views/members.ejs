<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <title><%= title %></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/output.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body class="bg-base-100 min-h-screen">
    <!-- Navigation -->
    <div class="navbar bg-primary text-primary-content shadow-lg">
        <div class="flex-1">
            <a href="/" class="btn btn-ghost text-xl">
                <i class="fas fa-book mr-2"></i>
                Library Management
            </a>
        </div>
        <div class="flex-none">
            <ul class="menu menu-horizontal px-1">
                <li><a href="/api/books" class="text-primary-content">üìö Books</a></li>
                <li><a href="/members" class="text-primary-content font-bold">üë• Members</a></li>
                <li><a href="/" class="text-primary-content">üè† Home</a></li>
            </ul>
        </div>
    </div>

    <div class="container mx-auto p-4">
        <!-- Header -->
        <div class="flex flex-col lg:flex-row justify-between items-center mb-6 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-base-content flex items-center gap-2">
                    <i class="fas fa-users text-primary"></i>
                    Members Management
                </h1>
                <p class="text-base-content/70 mt-1">Manage library members and their information</p>
            </div>
            <div class="flex gap-2">
                <button id="bulk-delete-btn" class="btn btn-error btn-sm" disabled>
                    <i class="fas fa-trash mr-1"></i>
                    Delete Selected
                </button>
                <button id="add-member-btn" class="btn btn-primary">
                    <i class="fas fa-user-plus mr-2"></i>
                    Add Member
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
            <!-- Members List Section -->
            <div class="xl:col-span-2">
                <div class="card bg-base-200 shadow-xl">
                    <div class="card-body">
                        <!-- Search Bar -->
                        <div class="flex flex-col sm:flex-row gap-4 mb-4">
                            <div class="flex-1">
                                <div class="join w-full">
                                    <input 
                                        id="search-input" 
                                        type="text" 
                                        placeholder="üîç Search by name or member ID..." 
                                        class="input input-bordered join-item flex-1"
                                    />
                                    <button id="search-btn" class="btn btn-primary join-item">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                            <button id="filter-btn" class="btn btn-outline btn-secondary">
                                <i class="fas fa-filter mr-1"></i>
                                Filters
                            </button>
                        </div>

                        <!-- Filter Options (Initially Hidden) -->
                        <div id="filter-options" class="hidden border rounded-lg p-4 mb-4 bg-base-100">
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text">Sort by</span>
                                    </label>
                                    <select id="sort-select" class="select select-bordered select-sm">
                                        <option value="Fname">First Name</option>
                                        <option value="Sname">Last Name</option>
                                        <option value="email">Email</option>
                                        <option value="join_date">Join Date</option>
                                    </select>
                                </div>
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text">Order</span>
                                    </label>
                                    <select id="order-select" class="select select-bordered select-sm">
                                        <option value="ASC">Ascending</option>
                                        <option value="DESC">Descending</option>
                                    </select>
                                </div>
                                <div class="form-control">
                                    <label class="label">
                                        <span class="label-text">Per page</span>
                                    </label>
                                    <select id="per-page-select" class="select select-bordered select-sm">
                                        <option value="10">10</option>
                                        <option value="25">25</option>
                                        <option value="50">50</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Member Count -->
                        <div class="flex justify-between items-center mb-4">
                            <div class="text-sm text-base-content/70">
                                <span id="member-count">Loading members...</span>
                            </div>
                            <div class="form-control">
                                <label class="label cursor-pointer gap-2">
                                    <span class="label-text text-sm">Select All</span>
                                    <input id="select-all" type="checkbox" class="checkbox checkbox-sm" />
                                </label>
                            </div>
                        </div>

                        <!-- Loading Spinner -->
                        <div id="loading" class="flex justify-center items-center py-8 hidden">
                            <div class="loading loading-spinner loading-md text-primary"></div>
                            <span class="ml-2 text-base-content/70">Loading...</span>
                        </div>

                        <!-- Members Table -->
                        <div class="overflow-x-auto">
                            <table class="table table-zebra">
                                <thead>
                                    <tr>
                                        <th>
                                            <input type="checkbox" class="checkbox checkbox-sm" disabled />
                                        </th>
                                        <th>ID</th>
                                        <th>üë§ Full Name</th>
                                        <th>üìß Email</th>
                                        <th>üì± Phone</th>
                                        <th>üìÖ Join Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="members-table-body">
                                    <!-- Members will be populated here -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <div class="flex justify-center mt-6">
                            <div class="join">
                                <button id="prev-page" class="join-item btn btn-sm">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <span id="page-info" class="join-item btn btn-sm btn-disabled">
                                    Page 1
                                </span>
                                <button id="next-page" class="join-item btn btn-sm">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Member Details Panel -->
            <div class="xl:col-span-1">
                <div class="card bg-base-200 shadow-xl sticky top-4">
                    <div class="card-body">
                        <h2 class="card-title text-lg mb-4">
                            <i class="fas fa-user-circle text-primary"></i>
                            Member Details
                        </h2>
                        
                        <div id="no-member-selected" class="text-center py-8">
                            <i class="fas fa-user-slash text-4xl text-base-content/20 mb-4"></i>
                            <p class="text-base-content/50">Select a member to view details</p>
                        </div>

                        <form id="member-details-form" class="hidden space-y-4">
                            <!-- Member ID (Read-only) -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">üÜî Member ID</span>
                                </label>
                                <input id="member-id" type="text" class="input input-bordered input-sm" readonly />
                            </div>

                            <!-- First Name -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">üë§ First Name <span class="text-error">*</span></span>
                                </label>
                                <input id="member-fname" type="text" class="input input-bordered input-sm" required />
                            </div>

                            <!-- Last Name -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">üë§ Last Name <span class="text-error">*</span></span>
                                </label>
                                <input id="member-sname" type="text" class="input input-bordered input-sm" required />
                            </div>

                            <!-- Email -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">üìß Email <span class="text-error">*</span></span>
                                </label>
                                <input id="member-email" type="email" class="input input-bordered input-sm" required />
                            </div>

                            <!-- Phone -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">üì± Phone <span class="text-error">*</span></span>
                                </label>
                                <input id="member-phone" type="tel" class="input input-bordered input-sm" required />
                            </div>

                            <!-- Address -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">üè† Address <span class="text-error">*</span></span>
                                </label>
                                <textarea id="member-address" class="textarea textarea-bordered" rows="2" required></textarea>
                            </div>

                            <!-- City -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">üèôÔ∏è City <span class="text-error">*</span></span>
                                </label>
                                <input id="member-city" type="text" class="input input-bordered input-sm" required />
                            </div>

                            <!-- Postcode -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">üìÆ Postcode <span class="text-error">*</span></span>
                                </label>
                                <input id="member-postcode" type="text" class="input input-bordered input-sm" required />
                            </div>

                            <!-- Join Date (Read-only) -->
                            <div class="form-control">
                                <label class="label">
                                    <span class="label-text">üìÖ Join Date</span>
                                </label>
                                <input id="member-join-date" type="text" class="input input-bordered input-sm" readonly />
                            </div>

                            <!-- Action Buttons -->
                            <div class="card-actions justify-end mt-6 gap-2">
                                <div id="view-mode-buttons">
                                    <button id="edit-member-btn" type="button" class="btn btn-primary btn-sm">
                                        <i class="fas fa-edit mr-1"></i>
                                        Edit
                                    </button>
                                    <button id="delete-member-btn" type="button" class="btn btn-error btn-sm">
                                        <i class="fas fa-trash mr-1"></i>
                                        Delete
                                    </button>
                                </div>
                                <div id="edit-mode-buttons" class="hidden">
                                    <button id="cancel-edit-btn" type="button" class="btn btn-outline btn-sm">
                                        Cancel
                                    </button>
                                    <button id="save-member-btn" type="button" class="btn btn-success btn-sm">
                                        <i class="fas fa-save mr-1"></i>
                                        Save
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Member Modal -->
    <dialog id="add-member-modal" class="modal">
        <div class="modal-box w-11/12 max-w-2xl">
            <form method="dialog">
                <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">‚úï</button>
            </form>
            <h3 class="font-bold text-lg mb-4">
                <i class="fas fa-user-plus text-primary mr-2"></i>
                Add New Member
            </h3>
            
            <form id="add-member-form" class="space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">First Name <span class="text-error">*</span></span>
                        </label>
                        <input name="Fname" type="text" class="input input-bordered" required />
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Last Name <span class="text-error">*</span></span>
                        </label>
                        <input name="Sname" type="text" class="input input-bordered" required />
                    </div>
                </div>

                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Email <span class="text-error">*</span></span>
                    </label>
                    <input name="email" type="email" class="input input-bordered" required />
                </div>

                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Phone <span class="text-error">*</span></span>
                    </label>
                    <input name="phone" type="tel" class="input input-bordered" required />
                </div>

                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Address <span class="text-error">*</span></span>
                    </label>
                    <textarea name="address" class="textarea textarea-bordered" rows="3" required></textarea>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">City <span class="text-error">*</span></span>
                        </label>
                        <input name="city" type="text" class="input input-bordered" required />
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Postcode <span class="text-error">*</span></span>
                        </label>
                        <input name="postcode" type="text" class="input input-bordered" required />
                    </div>
                </div>

                <div class="modal-action">
                    <button type="button" class="btn btn-outline" onclick="document.getElementById('add-member-modal').close()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-user-plus mr-1"></i>
                        Add Member
                    </button>
                </div>
            </form>
        </div>
    </dialog>

    <!-- Toast Notifications Container -->
    <div id="toast-container" class="toast toast-top toast-end z-50"></div>

    <!-- Include JavaScript -->
    <script src="/members.js"></script>
</body>
</html>